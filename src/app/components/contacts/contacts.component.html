<div class="bg-light h-100 d-flex flex-column">
  <div class="container py-4">
    <!-- Título -->
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4>Contacts</h4>
      <div class="actions-bar d-flex gap-2">
        <!--Ordenar?-->
        <button
          class="btn btn-outline-warning btn-sm"
          (click)="onFilterFavorite()"
        >
          <i *ngIf="!isFavorite" class="bi bi-star"></i>
          <i *ngIf="isFavorite" class="bi bi-star-fill"></i>
        </button>
        <select
          class="form-select form-select-sm"
          (change)="onFilterCategory($event)"
        >
          <option value="null" selected>Filter by Category</option>
          <option *ngFor="let category of categories" [value]="category.name">
            {{ category.name }}
          </option>
        </select>
        <select
          class="form-select form-select-sm"
          (change)="onFilterGroup($event)"
        >
          <option value="null" selected>Filter by Group</option>
          <option *ngFor="let group of groups" [value]="group.name">
            {{ group.name }}
          </option>
        </select>
        <input
          type="text"
          class="form-control form-control-sm"
          placeholder="Search for Contacts"
          (input)="search($event)"
        />
      </div>
    </div>

    <!-- Grid de Contatos -->
    <div class="row g-3">
      <div
        class="col-md-4"
        *ngFor="
          let contact of contacts
            | paginate
              : { itemsPerPage: itemsPerPage, currentPage: currentPage }
        "
      >
        <div
          class="contact-card bg-white position-relative overflow-hidden"
          style="cursor: pointer"
          (click)="openModal(ModalPreview, contact)"
        >
          <div
            class="card-actions position-absolute top-0 end-0 p-2 actions-hidden"
            style="cursor: pointer"
          >
            <i
              class="bi bi-pencil text-primary me-2 cursor-pointer fs-5"
              [routerLink]="['edit/', contact.id]"
            ></i>
            <i
              class="bi bi-trash text-danger cursor-pointer fs-5"
              (click)="deleteContact(contact.id)"
            ></i>
          </div>
          <div class="d-flex align-items-center mb-2" style="cursor: pointer">
            <div class="avatar-circle bg-primary me-2">
              {{ getInitials(contact.firstname, contact.lastname) }}
            </div>
            <div>
              <strong>{{ contact.firstname + " " + contact.lastname }} </strong
              ><br />
              <small class="text-muted">{{ contact.groups[0]?.name }}</small>
            </div>
          </div>
          <div class="text-muted small" style="cursor: pointer">
            <div>
              <i class="bi bi-telephone"></i>
              {{ contact.phones[0].phoneNumber | mask : "(99) 99999-9999" }}
            </div>
            <div>
              <i class="bi bi-envelope"></i> {{ contact.emails[0]?.email }}
            </div>
          </div>
        </div>
      </div>
      <pagination-controls
        (pageChange)="currentPage = $event"
        [autoHide]="true"
        previousLabel="«"
        nextLabel="»"
        class="d-flex justify-content-center mt-3"
      ></pagination-controls>
    </div>
  </div>
</div>

<ng-template #ModalPreview let-modal>
  <div class="modal-header">
    <h5 class="modal-title">Visualização do Contato</h5>
    <button type="button" class="btn-close" (click)="modal.dismiss()"></button>
  </div>

  <div class="modal-body">
    <form class="container-fluid">

      <!-- Nome e Sobrenome -->
      <div class="row g-2 mb-3">
        <div class="col-md-6">
          <label class="form-label">Nome</label>
          <input type="text" class="form-control" [value]="selectContact.firstname" disabled />
        </div>
        <div class="col-md-6">
          <label class="form-label">Sobrenome</label>
          <input type="text" class="form-control" [value]="selectContact.lastname" disabled />
        </div>
      </div>

      <!-- Favorito e Data -->
      <div class="row g-2 mb-3">
        <div class="col-md-6 d-flex align-items-end">
          <div class="form-check form-switch">
            <input type="checkbox" class="form-check-input" [checked]="selectContact.isFavorite" disabled />
            <label class="form-check-label">Favorito</label>
          </div>
        </div>
        <div class="col-md-6">
          <label class="form-label">Data de Nascimento</label>
          <input type="date" class="form-control" [value]="selectContact.birthDate" disabled />
        </div>
      </div>

      <!-- E-mails -->
      <div class="mb-3" *ngIf="selectContact.emails?.length">
        <label class="form-label">E-mails</label>
        <div class="row g-2" *ngFor="let email of selectContact.emails">
          <div class="col-md-4">
            <input type="text" class="form-control" [value]="email.label" disabled />
          </div>
          <div class="col-md-8">
            <input type="email" class="form-control" [value]="email.email" disabled />
          </div>
        </div>
      </div>

      <!-- Telefones -->
      <div class="mb-3" *ngIf="selectContact.phones?.length">
        <label class="form-label">Telefones</label>
        <div class="row g-2" *ngFor="let phone of selectContact.phones">
          <div class="col-md-4">
            <input type="text" class="form-control" [value]="phone.label" disabled />
          </div>
          <div class="col-md-8">
            <input type="tel" class="form-control" [value]="phone.phoneNumber" disabled />
          </div>
        </div>
      </div>

      <!-- Endereços -->
      <div class="mb-3" *ngIf="selectContact.addresses?.length">
        <label class="form-label">Endereços</label>
        <div class="border rounded p-3 mb-3" *ngFor="let addr of selectContact.addresses">
          <div class="mb-2">
            <input type="text" class="form-control" [value]="addr.country" placeholder="País" disabled />
          </div>
          <div class="row g-2 mb-2">
            <div class="col-md-10">
              <input type="text" class="form-control" [value]="addr.street" placeholder="Rua" disabled />
            </div>
            <div class="col-md-2">
              <input type="text" class="form-control" [value]="addr.number" placeholder="Número" disabled />
            </div>
          </div>
          <div class="row g-2 mb-2">
            <div class="col-md-6">
              <input type="text" class="form-control" [value]="addr.city" placeholder="Cidade" disabled />
            </div>
            <div class="col-md-2">
              <input type="text" class="form-control" [value]="addr.state" placeholder="Estado" disabled />
            </div>
            <div class="col-md-4">
              <input type="text" class="form-control" [value]="addr.postalCode" placeholder="CEP" disabled />
            </div>
          </div>
          <div class="mb-1">
            <input type="text" class="form-control" [value]="addr.neighborhood" placeholder="Bairro" disabled />
          </div>
          <div class="mb-2">
            <input type="text" class="form-control" [value]="addr.complement" placeholder="Complemento" disabled />
          </div>
        </div>
      </div>

      <!-- Categorias -->
      <div class="mb-3" *ngIf="selectContact.categories?.length">
        <label class="form-label">Categorias</label>
        <div class="d-flex flex-wrap gap-2">
          <span class="badge bg-secondary" *ngFor="let cat of selectContact.categories">
            {{ cat.name }}
          </span>
        </div>
      </div>

      <!-- Grupos -->
      <div class="mb-3" *ngIf="selectContact.groups?.length">
        <label class="form-label">Grupos</label>
        <div class="d-flex flex-wrap gap-2">
          <span class="badge bg-secondary" *ngFor="let grp of selectContact.groups">
            {{ grp.name }}
          </span>
        </div>
      </div>

      <!-- Notas -->
      <div class="mb-3">
        <label class="form-label">Notas</label>
        <textarea class="form-control" rows="3" [value]="selectContact.note" disabled></textarea>
      </div>

    </form>
  </div>

  <div class="modal-footer">
    <button class="btn btn-secondary" (click)="modal.dismiss()">Fechar</button>
  </div>
</ng-template>
